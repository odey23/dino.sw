<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Kotak Amal - Barbara</title>
    <link rel="stylesheet" href="dashboardstyle.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <!-- Cek token login -->
    <script>
      const token = localStorage.getItem("token");
      if (!token) window.location.href = "/";
    </script>

    <div class="dashboard-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="logo">
          <div class="logo-icon">
            <img src="/assets/Nailoong.jpeg" alt="" />
          </div>
          <div class="logo-text">Dino Wallet</div>
        </div>

        <nav>
          <div class="nav-section">
            <div class="nav-label">Menu</div>
            <a href="dashboard.html" class="nav-item active">
              <span>üìä</span>
              <span>Dashboard</span>
            </a>
            <a href="stats.html" class="nav-item" id="analyticsBtn">
              <span>üìà</span>
              <span>Analytics</span>
            </a>
          </div>
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="main-content">
        <!-- Top Bar -->
        <div class="top-bar">
          <div class="page-title">
            <h1>Dino Wallet</h1>
            <p>Your recent transaction activity and all</p>
          </div>

          <div class="top-actions">
            <div class="search-box">
            </div>

            <div class="user-profile">
              <div class="user-avatar" id="userAvatar">üë§</div>
              <div class="user-info">
                <div class="user-name" id="userName">Admin</div>
                <div class="user-role" id="userRole">admin@example.com</div>
              </div>
            </div>

            <button class="btn-logout" id="logoutBtn">Logout</button>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-label">Total Donasi</div>
              <div class="stat-icon">üíµ</div>
            </div>
            <div class="stat-value" id="totalDonasi">Rp 0</div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-label">Total Transaksi</div>
              <div class="stat-icon">üìù</div>
            </div>
            <div class="stat-value" id="totalTransaksi">0</div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-label">Device Aktif</div>
              <div class="stat-icon">üì±</div>
            </div>
            <div class="stat-value" id="deviceAktif">0</div>
          </div>
        </div>

        <!-- Table -->
        <div class="table-card">
          <div class="table-header">
            <h3>Riwayat Donasi</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Device</th>
                <th>Warna</th>
                <th>Nominal</th>
              </tr>
            </thead>
            <tbody id="donationTableBody">
              <!-- Data akan dimuat dari JavaScript -->
            </tbody>
          </table>
        </div>
      </main>
    </div>

    <!-- Popup konfirmasi logout -->
    <div class="overlay" id="logoutOverlay">
      <div class="popup">
        <h3>Apakah anda mau logout?</h3>
        <div class="popup-actions">
          <button class="btn-yes" id="confirmYes">Yes</button>
          <button class="btn-no" id="confirmNo">No</button>
        </div>
      </div>
    </div>

    <!-- Dashboard Script -->
    <script src="dashboard.js"></script>

    <script>
      // Tampilkan username sesuai role
      const userName = document.getElementById("userName");
      const userRole = document.getElementById("userRole");
      const userAvatar = document.getElementById("userAvatar");
      const username = localStorage.getItem("username") || "User";
      const role = localStorage.getItem("role") || "User";

      const displayName =
        role === "admin"
          ? "Admin"
          : role === "moderator"
          ? "Moderator"
          : username;
      userName.textContent = displayName;
      userRole.textContent = `${role}@example.com`;
      userAvatar.textContent = displayName.charAt(0).toUpperCase();

      // Logout popup
      const logoutBtn = document.getElementById("logoutBtn");
      const overlay = document.getElementById("logoutOverlay");
      const yesBtn = document.getElementById("confirmYes");
      const noBtn = document.getElementById("confirmNo");

      logoutBtn.addEventListener(
        "click",
        () => (overlay.style.display = "flex")
      );
      yesBtn.addEventListener("click", () => {
        localStorage.removeItem("token");
        localStorage.removeItem("role");
        localStorage.removeItem("username");
        window.location.href = "/";
      });
      noBtn.addEventListener("click", () => (overlay.style.display = "none"));

      // Switch ke stats.html
      document.getElementById("analyticsBtn").addEventListener("click", (e) => {
        e.preventDefault();
        window.location.href = "/stats";
      });

      // Hitung statistik tambahan
      function updateStats() {
        const tbody = document.getElementById("donationTableBody");
        const rows = tbody.getElementsByTagName("tr");

        // Total transaksi
        document.getElementById("totalTransaksi").textContent = rows.length;

        // Device aktif (unique devices)
        const devices = new Set();
        for (let row of rows) {
          const deviceCell = row.cells[1];
          if (deviceCell) devices.add(deviceCell.textContent);
        }
        document.getElementById("deviceAktif").textContent = devices.size;
      }

      // Jalankan update stats setelah data dimuat
      setTimeout(updateStats, 1000);
    </script>
  </body>
</html>
